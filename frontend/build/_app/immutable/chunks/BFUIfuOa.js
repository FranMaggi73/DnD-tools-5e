import{w as d}from"./4AD-5CNy.js";import{P as u}from"./B11dj0TC.js";import{t as g}from"./Bhbx1GBa.js";function b(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}const C=d("🎲 Grimorio de Aventuras"),h="https://dm-events-backend-858373640437.us-central1.run.app/api";console.log("🔧 Entorno:","production");console.log("🌐 API URL:",h);async function n(t,e={}){const r=u(g),o={"Content-Type":"application/json",...e.headers};r&&(o.Authorization=`Bearer ${r}`);const s=await fetch(`${h}${t}`,{...e,headers:o});if(!s.ok){const a=await s.json().catch(()=>({error:"Error en la petición"}));throw new Error(a.error||"Error en la petición")}return s.json()}const $={createCampaign:t=>n("/campaigns",{method:"POST",body:JSON.stringify(t)}),getCampaigns:()=>n("/campaigns"),getCampaign:t=>n(`/campaigns/${t}`),deleteCampaign:t=>n(`/campaigns/${t}`,{method:"DELETE"}),getCampaignMembers:t=>n(`/campaigns/${t}/members`),invitePlayer:(t,e)=>n(`/campaigns/${t}/invite`,{method:"POST",body:JSON.stringify({userEmail:e})}),removePlayer:(t,e)=>n(`/campaigns/${t}/players/${e}`,{method:"DELETE"}),getMyInvitations:()=>n("/invitations"),respondToInvitation:(t,e)=>n(`/invitations/${t}/respond`,{method:"POST",body:JSON.stringify({action:e})}),createCharacter:(t,e)=>n(`/campaigns/${t}/characters`,{method:"POST",body:JSON.stringify(e)}),getCampaignCharacters:t=>n(`/campaigns/${t}/characters`),updateCharacter:(t,e)=>n(`/characters/${t}`,{method:"PUT",body:JSON.stringify(e)}),deleteCharacter:t=>n(`/characters/${t}`,{method:"DELETE"}),createEncounter:(t,e)=>n(`/campaigns/${t}/encounters`,{method:"POST",body:JSON.stringify({name:e})}),getActiveEncounter:t=>n(`/campaigns/${t}/encounters/active`),endEncounter:t=>n(`/encounters/${t}`,{method:"DELETE"}),resetEncounter:t=>n(`/encounters/${t}/reset`,{method:"POST"}),addCombatant:(t,e)=>n(`/encounters/${t}/combatants`,{method:"POST",body:JSON.stringify(e)}),getCombatants:t=>n(`/encounters/${t}/combatants`),updateCombatant:(t,e)=>n(`/combatants/${t}`,{method:"PUT",body:JSON.stringify(e)}),removeCombatant:t=>n(`/combatants/${t}`,{method:"DELETE"}),nextTurn:t=>n(`/encounters/${t}/next-turn`,{method:"POST"})},y={searchMonsters:async t=>{const e=t.trim().toLowerCase(),r=await fetch(`https://api.open5e.com/v1/monsters/?search=${encodeURIComponent(e)}&limit=50`);if(!r.ok)throw new Error("Error buscando criaturas");const o=await r.json();return o.results&&(o.results=o.results.filter(s=>{var c;const a=s.name.toLowerCase(),i=((c=s.type)==null?void 0:c.toLowerCase())||"";return a.includes(e)||i.includes(e)}).sort((s,a)=>{const i=s.name.toLowerCase(),c=a.name.toLowerCase(),m=i.startsWith(e),p=c.startsWith(e);return m&&!p?-1:!m&&p?1:i.length-c.length}).slice(0,20)),o},getMonster:async t=>{const e=await fetch(`https://api.open5e.com/v1/monsters/${t}/`);if(!e.ok)throw new Error("Error obteniendo criatura");return e.json()},monsterToCombatant:(t,e)=>({type:"creature",name:t.name,initiative:e,maxHp:t.hit_points,currentHp:t.hit_points,armorClass:t.armor_class,isNpc:!0,creatureSource:"open5e"}),searchConditions:async t=>{const e=await fetch(`https://api.open5e.com/v1/conditions/?search=${encodeURIComponent(t)}&limit=5`);if(!e.ok)throw new Error("Error buscando condiciones");return e.json()},getCondition:async t=>{const e=await fetch(`https://api.open5e.com/v1/conditions/${t}/`);if(!e.ok)throw new Error("Error obteniendo condición");return e.json()},cleanDescription:(t,e=150)=>{const r=document.createElement("div");r.innerHTML=t;let o=r.textContent||r.innerText||"";return o.length>e&&(o=o.substring(0,e)+"..."),o}};export{$ as a,b as e,C as h,y as o};
